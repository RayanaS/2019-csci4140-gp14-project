<script type="text/javascript" src="../js/sidebar.js"></script>

<script language="JavaScript" type="text/javascript" src="../node_modules/p5/lib/p5.js"></script>
<script type="text/javascript" src="../node_modules/p5/lib/addons/p5.sound.js"></script>

<style>
.song {
    background: white;
    border-radius: 13px;
    width: 400px;
}

.song h1 {
    padding: 0.5em 0.8em;
    text-align: center;
}

.button {
    background-color: transparent;
    border: none;
    display: inline;
}

.myslider {
    -webkit-appearance: none;
    height: 6px;
    border-radius: 4px;
    background: #eeeeee;
    display: inline;
    -webkit-transition: .2s;
    transition: background .2s;
}
.myslider:hover {
    background: #4abbfc;
}

.myslider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 15px;
    height: 15px;
    border-radius: 7px;
    background: #454545;
    box-shadow: 1px 2px 3px rgba(0,0,0,0.5);
}

.noise img {
    height: 50px;
    width: auto;
    margin: 1.5em 1.5em 1em 1.5em;
    opacity: 0.4;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.noise img:hover {
    opacity: 1;
}

</style>

<div>
    <h1 style="padding: 0.3em 1em;">Combined Player</h1>

    <div class="song" id="bkcolor">
      <h1>Cosmic</h1>
        <input type="range" class="myslider" min="0" max="100" value="0" id="progress" style="width: 80%; margin: 1em 2.5em 1em 2.5em;">
        <div>

          <button class="button" onclick="togglePlaying();">
              <img id="img" src="../image/player/play.png" style="height: 40px; width: auto; margin: 1em 1.5em 1em 1.5em" alt="Play/Pause"/>
          </button>
          <img src="../image/player/volume.png" style="height: 25px; width: auto; margin-right: 10px">
          <input type="range" class="myslider" min="0" max="100" value="100" id="volume" style="width: 20%">
        </div>
    </div>

    <div class = "noise">
        <button class="button" onclick="loadCafe();">
            <img src="../image/cafe.png">
        </button>
        <img src="../image/campfire.png" onclick="">
        <button class="button" onclick="loadRain();">
            <img src="../image/rain.png">
        </button>
        <img src="../image/library.png" onclick="">
        <img src="../image/wine.png">
        <button class="button" onclick="loadConcert();">
            <img src="../image/concert.png">
        </button>
    </div>

</div>

<script>
    const { ipcRenderer } = require('electron');
    var song, noise, reverb, cVerb, length, bpm;

    var volume = document.getElementById("volume");
    var icon = document.getElementById("img");
    var progress = document.getElementById("progress");
    var bkcolor = document.getElementById("bkcolor");
    //linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)
    var play = "../image/player/play.png";
    var pause = "../image/player/pause.png";
    var volumeWeight = 1;

    var noisePath = [];
    noisePath["campfire"] = "../audio/env/campfire.mp3";
    noisePath["library"] = "../audio/env/library.mp3";

    function loadCafe() {
        bkcolor.background = "#B1806A";
        song.disconnect();
        reverb.process(song, 7, 48);

        noise.disconnect();
        noise = loadSound("../audio/env/cafe(louder).mp3", function () {
            if (song.isPlaying()) {noise.play();}
        });
        volumeWeight = 1;
    }

    function loadRain() {
        song.disconnect();
        reverb.process(song, 3, 40);

        noise.disconnect();
        noise = loadSound("../audio/white_noise/rain.mp3", function () {
            if (song.isPlaying()) {noise.play();}
        });
        noise.setVolume(0.5);
        volumeWeight = 0.5;
    }

    function loadConcert() {
        song.disconnect();
        cVerb.process(song);

        noise.disconnect();
        noise = loadSound("../audio/env/concert.mp3", function () {
            if (song.isPlaying()) {noise.play();}
        });
        noise.setVolume(0.75);
        volumeWeight = 0.75;
    }

    function preload() {
        reverb = new p5.Reverb();
        cVerb = new p5.Convolver("../IMreverbs/Narrow Bumpy Space.wav");

        song = loadSound("../audio/music/cosmic.mp3", loaded);
        noise = loadSound("../audio/env/cafe(louder).mp3");
    }

    function loaded() {
        length = song.duration();
        bpm = song.getBPM();
        console.log(bpm);
    }

    function setup() {
        // x second reverbTime, decayRate of x%
        song.disconnect();
        // Default: CAFE
        reverb.process(song, 7, 48);
    }

    function togglePlaying() {
        if (!song.isPlaying()) {
            song.play();
            icon.src = pause;
            noise.play();
        } else {
            song.pause();
            icon.src = play;
            noise.pause();
        }
    }

    volume.oninput = function () {
        song.setVolume(this.value / 100);
        noise.setVolume((this.value / 100) * volumeWeight);
    };

    progress.oninput = function () {
        song.playMode('restart');
    };

    var intrvl = setInterval( function(){
        if (song.isPlaying()) {
            progress.value = (song.currentTime() / length) * 100;
        }
    }, 1000);
    // clearInterval(intrvl); // if it's needed

</script>

<script type="text/javascript" src="../js/sidebar2.js"></script>